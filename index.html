<!doctype html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
<!--  <script type = "text/javascript" src="audio-recorder.js"></script>-->
<!--  <script type = "text/javascript" src="video-player.js"></script>-->
</head>


<!-- The video -->
<video autoplay muted loop id="video1">
  <source src="bitch-imma-bird.mp4" type="video/mp4">
</video>

<!-- Optional: some overlay text to describe the video -->
<div class="content">
  <p>talk-to-me</p>
  <!-- Use a button to pause/play the video with JavaScript -->
  <button id="videoBtn" onclick="myFunction()">Pause</button>
  <button id="audioBtn" onclick="AudioRecorder()">Record and Play</button>
</div>

<script>
// Get the video
var video = document.getElementById("video1");

// Get the button
var btn = document.getElementById("videoBtn");

// Pause and play the video, and change the button text
function myFunction() {
  if (video.paused) {
    video.play();
    btn.innerHTML = "Pause";
  } else {
    video.pause();
    btn.innerHTML = "Play";
  }
}
</script>

<script>
const recordAudio = () => {
  return new Promise(resolve => {
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        const mediaRecorder = new MediaRecorder(stream);
        const audioChunks = [];

        mediaRecorder.addEventListener("dataavailable", event => {
          audioChunks.push(event.data);
        });

        const start = () => {
          mediaRecorder.start();
        };

        const stop = () => {
          return new Promise(resolve => {
            mediaRecorder.addEventListener("stop", () => {
              const audioBlob = new Blob(audioChunks);
              const audioUrl = URL.createObjectURL(audioBlob);
              const audio = new Audio(audioUrl);
              const play = () => {
                audio.play();
              };

              resolve({ audioBlob, audioUrl, play });
            });

            mediaRecorder.stop();
          });
        };

        resolve({ start, stop });
      });
  });
};

function AudioRecorder() {
(async () => {
  const recorder = await recordAudio();
  recorder.start();

  setTimeout(async () => {
    const audio = await recorder.stop();
    audio.play();
  }, 3000);
})();
}
</script>

<script src="http://cwilso.github.com/AudioContext-MonkeyPatch/AudioContextMonkeyPatch.js"></script>

</html>